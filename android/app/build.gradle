// android/app/build.gradle (module-level)

plugins {
    id "com.android.application"
    id "org.jetbrains.kotlin.android"
    // The Flutter Gradle Plugin must be applied after the Android and Kotlin plugins.
    id "dev.flutter.flutter-gradle-plugin"
}

android {
    namespace "com.cryptowallet.app"
    compileSdk flutter.compileSdkVersion
    ndkVersion flutter.ndkVersion

    defaultConfig {
        applicationId "com.cryptowallet.app"

        minSdk flutter.minSdkVersion
        targetSdk flutter.targetSdkVersion

        versionCode flutter.versionCode
        versionName flutter.versionName

        multiDexEnabled true
        // If you run unit tests that need Android resources:
        // testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }

    // --- Java/Kotlin 17 ---
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
    }
    kotlinOptions {
        jvmTarget = "17"
    }
    // -----------------------

    buildTypes {
        debug {
            // your debug options
        }
        release {
            // TODO: replace with your real signing config
            signingConfig signingConfigs.debug

            // (Optional) keep code shrinking defaults; enable when you add proguard files.
            // minifyEnabled true
            // shrinkResources true
            // proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'

            // (Temporary escape hatch if lint blocks release while migrating)
            // lint {
            //     checkReleaseBuilds false
            //     abortOnError false
            // }
        }
    }

    // (Optional) prevent common META-INF dupes during packaging
    packagingOptions {
        resources {
            excludes += [
                "META-INF/LICENSE*",
                "META-INF/NOTICE*",
                "META-INF/AL2.0",
                "META-INF/LGPL2.1"
            ]
        }
    }

    // (Optional) If you run a lot of unit tests locally:
    // testOptions {
    //     unitTests.all {
    //         it.jvmArgs += ['-Xmx2g']
    //     }
    // }
}

flutter {
    source "../.."
}

dependencies {
  implementation "androidx.multidex:multidex:2.0.1"
  testImplementation "org.mockito:mockito-core:5.11.0" // stays on Byte Buddy 1.14.x

  constraints {
    implementation("org.bouncycastle:bcprov-jdk18on:1.77")
    implementation("org.bouncycastle:bcpkix-jdk18on:1.77")
    implementation("org.bouncycastle:bcutil-jdk18on:1.77")
    testImplementation("org.bouncycastle:bcprov-jdk18on:1.77")
    testImplementation("org.bouncycastle:bcpkix-jdk18on:1.77")
    testImplementation("org.bouncycastle:bcutil-jdk18on:1.77")
  }
}

